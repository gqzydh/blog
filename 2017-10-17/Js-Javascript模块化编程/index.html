<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="前端博客">
  <meta name="keywords" content="web前端, Web, 前端开发, 前端博客">
  
    <link rel="icon" href="/images/favicon_32X32.ico">
  
  
  <title>Javascript模块化编程 | 前端博客</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.css" /> -->
</head>

<body>
  <header>
  <div class="header-nav">
    <div class="header-container">
    <a class='logo' href="/">
      <span>前端博客</span>
    </a>

    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">首页</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/categories" class="item-link">分类</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">归档</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">标签</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">关于</a>
          
        </li>
      
    </ul>
  </div>
  </div>

</header>

  <!-- 帖子 -->
<main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h2>Javascript模块化编程</h2>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2017_10_17</time>
            
              | <i class="fa fa-folder-open-o" aria-hidden="true"></i> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Javascript/">Javascript</a>
  </div>





            
            
              | 
                  <i class="fa fa-tag" aria-hidden="true"></i>
                
               
  <a href="/tags/#Javascript" class='tag'>Javascript</a>


            
          </div>
          <h3 id="js模块化-立即执行函数写法"><a href="#js模块化-立即执行函数写法" class="headerlink" title="js模块化-立即执行函数写法"></a>js模块化-立即执行函数写法</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var module1 = (function()&#123;</span><br><span class="line">　　　　var _count = 0;</span><br><span class="line">　　　　var m1 = function()&#123;</span><br><span class="line">　　　　　　//...</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　　　var m2 = function()&#123;</span><br><span class="line">　　　　　　//...</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　　　return &#123;</span><br><span class="line">　　　　　　m1 : m1,</span><br><span class="line">　　　　　　m2 : m2</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　&#125;)();</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="js模块化-放大模式"><a href="#js模块化-放大模式" class="headerlink" title="js模块化-放大模式"></a>js模块化-放大模式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var module1 = (function (mod)&#123;</span><br><span class="line">　　　　mod.m3 = function () &#123;</span><br><span class="line">　　　　　　//...</span><br><span class="line">　　　　&#125;;</span><br><span class="line">　　　　return mod;</span><br><span class="line">&#125;)(module1);</span><br></pre></td></tr></table></figure>
<h3 id="js模块化-宽放大模式"><a href="#js模块化-宽放大模式" class="headerlink" title="js模块化-宽放大模式"></a>js模块化-宽放大模式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var module1 = ( function (mod)&#123;</span><br><span class="line">　　　　//...</span><br><span class="line">　　　　return mod;</span><br><span class="line">&#125;)(window.module1 || &#123;&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="js模块化-输入全局变量"><a href="#js模块化-输入全局变量" class="headerlink" title="js模块化-输入全局变量"></a>js模块化-输入全局变量</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var module1 = (function ($, YAHOO) &#123;</span><br><span class="line">　　　　//...</span><br><span class="line">&#125;)(jQuery, YAHOO);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的module1模块需要使用jQuery库和YUI库，就把这两个库（其实是两个模块）当作参数输入module1。这样做除了保证模块的独立性，还使得模块之间的依赖关系变得明显</p>
</blockquote>
<h2 id="require-js的用法"><a href="#require-js的用法" class="headerlink" title="require.js的用法"></a>require.js的用法</h2><ol>
<li>实现js文件的异步加载，避免网页失去响应；</li>
<li>管理模块之间的依赖性，便于代码的编写和维护。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">　&lt;script src=&quot;js/require.js&quot; defer async=&quot;true&quot; &gt;&lt;/script&gt;  //async/defer属性表明这个文件需要异步加载</span><br></pre></td></tr></table></figure>
<p>加载main.js 代码<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src=&quot;js/require.js&quot; data-main=&quot;js/main&quot;&gt;&lt;/script&gt; //data-main属性的作用是，指定网页程序的主模块。</span><br></pre></td></tr></table></figure></p>
<ul>
<li>主模块依赖于其他模块，这时就要使用AMD规范定义的的require()函数。<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// main.js</span><br><span class="line">　　require([&apos;moduleA&apos;, &apos;moduleB&apos;, &apos;moduleC&apos;], function (moduleA, moduleB, moduleC)&#123;</span><br><span class="line">　　　　// 这里写代码</span><br><span class="line">　　&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>require()函数接受两个参数。<strong>01</strong>参数是一个数组，表示所依赖的模块，[‘moduleA’, ‘moduleB’, ‘moduleC’]，即主模块依赖这三个模块；<strong>02</strong>参数是一个回调函数，当前面指定的模块都加载成功后，它将被调用。加载的模块会以参数形式传入该函数，从而在回调函数内部就可以使用这些模块。</p>
</blockquote>
<ul>
<li>eg:主模块依赖jquery、underscore和backbone这三个模块，main.js就可以这样写：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">　　require([&apos;jquery&apos;, &apos;underscore&apos;, &apos;backbone&apos;], function ($, _, Backbone)&#123;</span><br><span class="line">　　　　// 这里写代码</span><br><span class="line">　　&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>require.js会先加载jQuery、underscore和backbone，然后再运行回调函数。主模块的代码就写在回调函数中。</p>
</blockquote>
<h2 id="模块的加载"><a href="#模块的加载" class="headerlink" title="模块的加载"></a>模块的加载</h2><blockquote>
<p>require.config()方法，可以对模块的加载行为进行自定义。require.config()就写在主模块（main.js）的头部。参数就是一个对象，这个对象的paths属性指定各个模块的加载路径。</p>
</blockquote>
<ol>
<li><p>比如js/lib目录，有两种写法。一种是逐一指定路径。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require.config(&#123;</span><br><span class="line">　　　　paths: &#123;</span><br><span class="line">　　　　　　&quot;jquery&quot;: &quot;lib/jquery.min&quot;,</span><br><span class="line">　　　　　　&quot;underscore&quot;: &quot;lib/underscore.min&quot;,</span><br><span class="line">　　　　　　&quot;backbone&quot;: &quot;lib/backbone.min&quot;</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>直接改变基目录</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">　require.config(&#123;</span><br><span class="line">　　　　baseUrl: &quot;js/lib&quot;,</span><br><span class="line">　　　　paths: &#123;</span><br><span class="line">　　　　　　&quot;jquery&quot;: &quot;jquery.min&quot;,</span><br><span class="line">　　　　　　&quot;underscore&quot;: &quot;underscore.min&quot;,</span><br><span class="line">　　　　　　&quot;backbone&quot;: &quot;backbone.min&quot;</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果模块在另一台主机上，也可以直接指定它的网址</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require.config(&#123;</span><br><span class="line">　　　　paths: &#123;</span><br><span class="line">　　　　　　&quot;jquery&quot;: &quot;https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min&quot;</span><br><span class="line">　　　　&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="AMD模块的写法"><a href="#AMD模块的写法" class="headerlink" title="AMD模块的写法"></a>AMD模块的写法</h2><blockquote>
<p>模块必须采用特定的define()函数来定义。如果一个模块不依赖其他模块，那么可以直接定义在define()函数之中。</p>
</blockquote>
<ul>
<li>假定现在有一个math.js文件，它定义了一个math模块。<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// math.js</span><br><span class="line">define(function()&#123;</span><br><span class="line">    var add = function(x,y)&#123;</span><br><span class="line">        return x+y;</span><br><span class="line">    &#125;;</span><br><span class="line">    return&#123;</span><br><span class="line">        add: add</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>加载方法如下：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require([&apos;math&apos;], function(math)&#123;</span><br><span class="line">   alert(math.add(1,1)); </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>如果这个模块还依赖其他模块，必须是一个数组，指明该模块的依赖性。<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">define([&apos;myLib&apos;], function(myLib)&#123;</span><br><span class="line">　　　　function foo()&#123;</span><br><span class="line">　　　　　　myLib.doSomething();</span><br><span class="line">　　　　&#125;</span><br><span class="line">　　　　return &#123;</span><br><span class="line">　　　　　　foo : foo</span><br><span class="line">　　　　&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>当require()函数加载上面这个模块的时候，就会先加载myLib.js文件。</p>
</blockquote>
<h2 id="加载非规范的模块"><a href="#加载非规范的模块" class="headerlink" title="加载非规范的模块"></a>加载非规范的模块</h2><blockquote>
<p>require()加载之前，要先用require.config()方法，定义它们的一些特征。</p>
</blockquote>
<p>eg: underscore和backbone这两个库<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require.config(&#123;</span><br><span class="line">    shim:&#123;</span><br><span class="line">        &apos;underscore&apos;:&#123;</span><br><span class="line">            exports: &apos;_&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;backbone&apos;:&#123;</span><br><span class="line">            deps:[&apos;underscore&apos;, &apos;jquery&apos;],</span><br><span class="line">            exports: &apos;Backbone&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;) //shim属性，专门用来配置不兼容的模块</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>（1）exports值（输出的变量名），表明这个模块外部调用时的名称；（2）deps数组，表明该模块的依赖性。</p>
</blockquote>
<h2 id="require-js插件"><a href="#require-js插件" class="headerlink" title="require.js插件"></a>require.js插件</h2><blockquote>
<p>require.js还提供一系列插件，实现一些特定的功能。</p>
<ul>
<li>domready插件，可以让回调函数在页面DOM结构加载完成后再运行。<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require([&apos;domready!&apos;], function (doc)&#123;</span><br><span class="line">　　// called once the DOM is ready</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<ul>
<li>text和image插件，则是允许require.js加载文本和图片文件。<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">define([</span><br><span class="line">　　　　&apos;text!review.txt&apos;,</span><br><span class="line">　　　　&apos;image!cat.jpg&apos;</span><br><span class="line">　　　　],</span><br><span class="line">　　　　function(review,cat)&#123;</span><br><span class="line">　　　　　　console.log(review);</span><br><span class="line">　　　　　　document.body.appendChild(cat);</span><br><span class="line">　　　　&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>类似的插件还有json和mdown，用于加载json文件和markdown文件。</p>

        </section>
    </article>
    
    
        <!-- livere 评论框 start -->
        <div class="comment">
            <div id="lv-container" data-id="city" data-uid="your_livere_uid"></div>
        </div>
        <!-- livere 评论框 end -->
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h2>目录</h2>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#js模块化-立即执行函数写法"><span class="toc-number">1.</span> <span class="toc-text">js模块化-立即执行函数写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#js模块化-放大模式"><span class="toc-number">2.</span> <span class="toc-text">js模块化-放大模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#js模块化-宽放大模式"><span class="toc-number">3.</span> <span class="toc-text">js模块化-宽放大模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#js模块化-输入全局变量"><span class="toc-number">4.</span> <span class="toc-text">js模块化-输入全局变量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#require-js的用法"><span class="toc-number"></span> <span class="toc-text">require.js的用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模块的加载"><span class="toc-number"></span> <span class="toc-text">模块的加载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMD模块的写法"><span class="toc-number"></span> <span class="toc-text">AMD模块的写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加载非规范的模块"><span class="toc-number"></span> <span class="toc-text">加载非规范的模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#require-js插件"><span class="toc-number"></span> <span class="toc-text">require.js插件</span></a>
        </div>
    </div>
    
  </aside>
</main>


<script type="text/javascript">
  (function(d, s) {
      var j, e = d.getElementsByTagName(s)[0];

      if (typeof LivereTower === 'function') { return; }

      j = d.createElement(s);
      j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
      j.async = true;

      e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>


  <footer id="fooler">
  <div class="copyright">
    <div>
      <span style="padding-right:30px;">
      &copy; 2018 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </span>
      
       本站总访客数 : <span id="busuanzi_value_site_uv"></span>人次 |
       本站总访问量 : <span id="busuanzi_value_site_pv"></span>次
      

    </div>
    <div>
      <!-- Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a> -->
    </div>
  </div>
</footer>

<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script src="/js/script.js"></script>


<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});

  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");

      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.1.20/jquery.fancybox.min.js"></script> -->



<div class="nodisplay">
<script src="https://s22.cnzz.com/z_stat.php?id=1272859133&web_id=1272859133" language="JavaScript"></script>
</div>



  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



</body>
</html>
